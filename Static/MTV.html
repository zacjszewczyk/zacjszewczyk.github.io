<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>FMTV RV Builder</title>
        <meta name="description" content="FMTV RV Builder">
        <meta name="author" content="Zac Szewczyk">
    </head>
    <style type="text/css">
    /* Debug */
    section, main
    {
        border: 1px solid black;
    }
    #angled
    {
        position: absolute;
        background-color: transparent;

        border-style: solid;
        border-color: #807F17 transparent transparent transparent;
    }
    body
    {
        margin: 0;
        padding: 0;
    }
    #box
    {
        position: absolute;
        left: 317px;
        top: 93px;
        height: 229px;
        width: 469px;
        z-index: 1;
        background-color: #807F17;
    }
    #container
    {
        position: absolute;
        background-color: #807F17;
    }
    #controls div
    {
        margin: 1em 0;
    }
    #images
    {
        position: relative;
        padding: 10em 0 0 3em;
        height: 325px;
    }
    #images img
    {
        opacity: .7;
        position: absolute;
        width: 46em;
    }
    main
    {
        width: 70em;
        margin: 0 auto;
    }
    #M1078
    {
        width: 42em !important;
    }
    #M1083
    {
        display: none;
    }
    #topper
    {
        position: absolute;
        top: -50px;
        left: 200px;
        display: none;

        border-style: solid;
        border-width: 0 0 50px 50px;
        border-color: transparent transparent #807F17 transparent;
    }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript">
    console.log(document.cookie);

    // Variables
    var position;
    var dimensions;

    // Functions
    function adjustSize() {
        var field = document.getElementById("box_length_field");

        if (field.value >= 12 && field.value <= 14) {
            angledSize();
            $("#container").hide();
            $("#box").show().width(field.value*33.5);
            adjustTopper();
        }
        else if (field.value > 14) {
            if ($("#M1078").css("display") == "block") {
                $("#box").show().width(14*33.5);
                angledSize();
            }
            else {
                if (field.value <= 16) {
                    $("#box").show().width(field.value*33.5);
                    angledSize();
                    $("#container").hide();
                }
                else {                        
                    $("#box").show().width(16*33.5);
                    angledSize();
                }
            }
        }
        adjustTopper();
        updateCookie();
    }
    function angledSize() {
        var offset = 0;
        offset = getChassis();

        var field = document.getElementById("box_length_field");

        dimensions = {width : parseInt($("#box").css("width")), height : parseInt($("#box").css("height")) };
                
        $("#container").show();
        $("#container").css("height", 229-(0.839*(field.value-offset)*35.5));
        $("#container").css("width", (field.value-offset)*35.5);
        $("#angled").css("top", dimensions.height-(0.839*(field.value-offset)*35.5));
        $("#container").css("left", dimensions.width);
        $("#angled").css("border-width", (0.839*(field.value-offset)*35.5).toString()+"px "+((field.value-offset)*35.5).toString()+"px 0 0");
    }
    function getChassis() {
        if ($(".chassis")[0].checked == true) {
            return 14;
        } else {
            return 16;
        }
    }
    function adjustTopper() {
        $("#topper").css("width", parseFloat($("#box").css("width").replace("px", ""))-250+parseFloat($("#container").css("width").replace("px", "")));
    }
    function flip(element) {
        if ($(element).css("transform") == "none") {
            $("#images").css("-moz-transform", "scaleX(-1)");
            $("#images").css("-o-transform", "scaleX(-1)");
            $("#images").css("-webkit-transform", "scaleX(-1)");
            $("#images").css("transform", "scaleX(-1)");
        }
        else
        {
            $("#images").css("-moz-transform", "");
            $("#images").css("-o-transform", "");
            $("#images").css("-webkit-transform", "");
            $("#images").css("transform", "");
        }
    }
    function updateCookie() {
        var view = $(".view:checked").val();
        var chassis = $(".chassis:checked").val();
        var box = $("#box_length_field").val();
        var topper = $("#raised_roof_checkbox").val();
        document.cookie = "rv=view="+view+",chassis="+chassis+",box="+box+",topper="+topper+";";
    }

    // End functions
    $( document ).ready(function() {
        adjustSize();
        // View selector
        $(".view").click(function() {
            flip($("#images"));
        });

        // Chassis selector
        $("#M1083_button").click(function() {
            $("#M1078").hide();
            $("#M1083").show();
            $("#box_length_field").attr("max", 23);
            adjustSize();
        })
        $("#M1078_button").click(function() {
            $("#M1083").hide();
            $("#M1078").show();
            if (document.getElementById("box_length_field").value > 21) {
                document.getElementById("box_length_field").value = 21;
            }
            $("#box_length_field").attr("max", 21);
            adjustSize();
        })

        // Box length checkboxes
        $(".box_length_checkbox").click(function() {
            document.getElementById("box_length_field").value = this.value;
            adjustSize()
            $(".box_length_checkbox").prop("checked", false);
            $(this).prop("checked", true);
        });

        // Box length field
        $("#box_length_field").on('input', function() {
            $(".box_length_checkbox").prop("checked", false);
            if ((getChassis() == 14 && this.value <= 21) || (getChassis() == 16 && this.value <= 23)) {
                adjustSize();
            }
        });

        // Raised roof checkbox
        $("#raised_roof_checkbox").click(function() {
            $("#topper").toggle();
            this.value = $("#topper").css("display");
            updateCookie();
        });
    });
    </script>
    <body>
        <main>
            <section id="images">
                <div id="box">
                    <div id="topper"></div>
                    <div id="container">
                        <div id="filler"></div>
                        <div id="angled"></div>
                    </div>
                </div>
                <img id="M1078" src="Static/Images/M1078_new.png" />
                <img id="M1083" src="Static/Images/M1083_new.png" />
            </section>
            <section id="controls">
                <div>
                    View:
                    <input type="radio" id="left_view" name="view" class="view" value="left" checked>
                    <label for="left_view">Left</label>
                    <input type="radio" id="right_view" name="view" class="view" value="right">
                    <label for="right_view">Right</label>
                </div>
                <div>
                    <input class="chassis" type="radio" id="M1078_button" name="FMTV" value="14" checked>
                    <label for="M1078_button">M1078</label>
                    <input class="chassis" type="radio" id="M1083_button" name="FMTV" value="16">
                    <label for="M1083_button">M1083</label>
                </div>
                <div>
                    <input type="checkbox" class="box_length_checkbox" id="14ft_box_button" name="box" value="14" checked>
                    <label for="14ft_box_button">14' Box</label>
                    <input type="checkbox" class="box_length_checkbox" id="16ft_box_button" name="box" value="16">
                    <label for="16ft_box_button">16' Box</label>
                </div>
                <div>
                    <label for="box_length_field">Box length (ft)</label>
                    <input type="number" name="box_length_field" id="box_length_field" max="21" value="14" />
                </div>
                <div>
                    <label for="raised_roof_checkbox">Raised roof: </label>
                    <input type="checkbox" id="raised_roof_checkbox" value="none" />
                </div>
            </section>
        </main>
    </body>
</html>